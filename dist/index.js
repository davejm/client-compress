!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define([],t):"object"==typeof exports?exports.Compress=t():e.Compress=t()}(window,function(){return function(e){var t={};function n(i){if(t[i])return t[i].exports;var r=t[i]={i:i,l:!1,exports:{}};return e[i].call(r.exports,r,r.exports,n),r.l=!0,r.exports}return n.m=e,n.c=t,n.d=function(e,t,i){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:i})},n.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=6)}([function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default={orientation:function(e){return new Promise(function(t,n){var i=new window.FileReader;i.onload=function(e){var n=new DataView(e.target.result);65496!==n.getUint16(0,!1)&&t(-2);for(var i=n.byteLength,r=2;r<i;){var a=n.getUint16(r,!1);if(r+=2,65505===a){1165519206!==n.getUint32(r+=2,!1)&&t(-1);var o=18761===n.getUint16(r+=6,!1);r+=n.getUint32(r+4,o);var u=n.getUint16(r,o);r+=2;for(var s=0;s<u;s++)274===n.getUint16(r+12*s,o)&&t(n.getUint16(r+12*s+8,o))}else{if(65280!=(65280&a))break;r+=n.getUint16(r,!1)}}t(-1)},i.readAsArrayBuffer(e.slice(0,65536))})}},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default=function e(t){var n=t.quality,i=void 0===n?.75:n,r=t.size,a=void 0===r?2:r,o=t.maxWidth,u=void 0===o?1920:o,s=t.maxHeight,l=void 0===s?1920:s,d=t.resize,f=void 0===d||d;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.start=window.performance.now(),this.end=null,this.alt=null,this.ext=null,this.startSize=null,this.startWidth=null,this.startHeight=null,this.size=1e3*a*1e3,this.endSize=null,this.endWidth=null,this.endHeight=null,this.iterations=0,this.base64prefix=null,this.quality=i,this.resize=f,this.maxWidth=u,this.maxHeight=l,this.orientation=1},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default={load:function(e){return new Promise(function(t,n){var i=new window.Image;i.addEventListener("load",function(){t(i)},!1),i.addEventListener("error",function(e){n(e)},!1),i.src=e})},resize:function(e,t){return function(n,i){if(!e&&!t)return{width:n,height:i};var r=n/i,a=void 0,o=void 0;return r>e/t?o=(a=Math.min(n,e))/r:a=(o=Math.min(i,t))*r,{width:a,height:o}}}},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default={load:function(e){return new Promise(function(t,n){var i=new window.FileReader;i.addEventListener("load",function(e){t(e.target.result)},!1),i.addEventListener("error",function(e){n(e)},!1),i.readAsDataURL(e)})}},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default={base64ToFile:function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"image/jpeg",n=window.atob(e),i=[],r=0;r<n.length;r++)i[r]=n.charCodeAt(r);return new window.Blob([new Uint8Array(i)],{type:t})},imageToCanvas:function(e,t,n){var i=document.createElement("canvas"),r=i.getContext("2d");return i.width=e,i.height=t,function(a){if(!n||n>8)return r.drawImage(a,0,0,i.width,i.height),i;switch(n>4&&(i.width=t,i.height=e),n){case 2:r.translate(e,0),r.scale(-1,1);break;case 3:r.translate(e,t),r.rotate(Math.PI);break;case 4:r.translate(0,t),r.scale(1,-1);break;case 5:r.rotate(.5*Math.PI),r.scale(1,-1);break;case 6:r.rotate(.5*Math.PI),r.translate(0,-t);break;case 7:r.rotate(.5*Math.PI),r.translate(e,-t),r.scale(-1,1);break;case 8:r.rotate(-.5*Math.PI),r.translate(-e,0)}return n>4?r.drawImage(a,0,0,i.height,i.width):r.drawImage(a,0,0,i.width,i.height),i}},canvasToBase64:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:.75;return e.toDataURL("image/jpeg",t)},size:function(e){return{kB:e/1e3,MB:e/1e6}}},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});t.default={size:function(e){return(e.replace(/^data:image\/\w+;base64,/,"").length-814)/1.37},mime:function(e){return e.split(";")[0].match(/jpeg|png|gif/)[0]},data:function(e){return e.replace(/^data:image\/\w+;base64,/,"")},prefix:function(e){return"data:"+e+";base64,"}},e.exports=t.default},function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=function(){function e(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,n,i){return n&&e(t.prototype,n),i&&e(t,i),t}}(),r=d(n(5)),a=d(n(4)),o=d(n(3)),u=d(n(2)),s=d(n(1)),l=d(n(0));function d(e){return e&&e.__esModule?e:{default:e}}var f=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}return i(e,[{key:"attach",value:function(e,t){var n=this;return new Promise(function(i,r){var a=document.querySelector(e);a.setAttribute("accept","image/*"),a.addEventListener("change",function(e){var r=n.compress([].concat(function(e){if(Array.isArray(e)){for(var t=0,n=Array(e.length);t<e.length;t++)n[t]=e[t];return n}return Array.from(e)}(e.target.files)),t);i(r)},!1)})}},{key:"_compressFile",value:function(e,t){var n=new s.default(t);return n.start=window.performance.now(),n.alt=e.name,n.ext=e.type,n.startSize=e.size,l.default.orientation(e).then(function(t){return n.orientation=t,o.default.load(e)}).then(this._compressImage(n))}},{key:"_compressImage",value:function(e){var t=this;return function(n){return u.default.load(n).then(function(t){if(e.startWidth=t.naturalWidth,e.startHeight=t.naturalHeight,e.resize){var n=u.default.resize(e.maxWidth,e.maxHeight)(t.naturalWidth,t.naturalHeight),i=n.width,r=n.height;e.endWidth=i,e.endHeight=r}else e.endWidth=t.naturalWidth,e.endHeight=t.naturalHeight;return a.default.imageToCanvas(e.endWidth,e.endHeight,e.orientation)(t)}).then(function(n){return e.iterations=0,e.base64prefix=r.default.prefix(e.ext),t._loopCompression(n,e.startSize,e.quality,e.size)}).then(function(t){var n=t.base64str,i=t.quality,a=t.iterations;return e.finalSize=r.default.size(n),e.iterations=a,e.quality=i,r.default.data(n)}).then(function(t){e.end=window.performance.now();var n=e.end-e.start;return{data:t,prefix:e.base64prefix,elapsedTimeInSeconds:n/1e3,alt:e.alt,initialSizeInMb:a.default.size(e.startSize).MB,endSizeInMb:a.default.size(e.finalSize).MB,ext:e.ext,quality:e.quality,endWidthInPx:e.endWidth,endHeightInPx:e.endHeight,initialWidthInPx:e.startWidth,initialHeightInPx:e.startHeight,sizeReducedInPercent:(e.startSize-e.finalSize)/e.startSize*100,iterations:e.iterations}})}}},{key:"_loopCompression",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,i=arguments[3],o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:.5,u=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1,s=a.default.canvasToBase64(e,n),l=r.default.size(s);if(console.log(l),l>i){if(n.toFixed(10)-.1<o)throw new Error("Couldn't compress image to specified max size");return this._loopCompression(e,l,n-.1,i,o,u+1)}return{base64str:s,quality:n,iterations:u}}},{key:"compress",value:function(e,t){var n=this;return Promise.all(e.map(function(e){return n._compressFile(e,t)}))}}],[{key:"convertBase64ToFile",value:function(e,t){return a.default.base64ToFile(e,t)}}]),e}();t.default=f,e.exports=t.default}])});